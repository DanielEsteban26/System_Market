<Window x:Class="System_Market.Views.CategoriaWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:sys="clr-namespace:System;assembly=System.Runtime"
        Title="Gestión de Categorías"
        Height="480" Width="780"
        MinHeight="380" MinWidth="560"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource MainBgLocal}"
        FontFamily="Segoe UI"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True">
    <Window.Resources>
        <!-- Fondo degradado principal de la ventana -->
        <LinearGradientBrush x:Key="MainBgLocal" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#0B2E3A" Offset="0"/>
            <GradientStop Color="#117A8A" Offset="1"/>
        </LinearGradientBrush>

        <!-- Paleta de colores y métricas reutilizables -->
        <SolidColorBrush x:Key="CardBg" Color="#0D1B22"/>
        <SolidColorBrush x:Key="CardBgLight" Color="#12242C"/>
        <SolidColorBrush x:Key="AccentTeal" Color="#19C1D3"/>
        <SolidColorBrush x:Key="AccentBlue" Color="#0288D1"/>
        <SolidColorBrush x:Key="DangerColor" Color="#D9534F"/>
        <SolidColorBrush x:Key="HeaderText" Color="#E8F6F9"/>
        <SolidColorBrush x:Key="MutedText" Color="#8EA6AB"/>
        <SolidColorBrush x:Key="RowDivider" Color="#23333A"/>
        <sys:Double x:Key="CtlHeight">40</sys:Double>
        <Thickness x:Key="CtlPadding">14,6</Thickness>
        <sys:Double x:Key="CtlFontSize">13</sys:Double>

        <!-- Estilo base para botones tipo píldora -->
        <Style x:Key="PillButtonBase" TargetType="Button">
            <Setter Property="Foreground" Value="{StaticResource HeaderText}"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="MinHeight" Value="36"/>
            <Setter Property="MinWidth" Value="110"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}" CornerRadius="18" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.03" ScaleY="1.03"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bd" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.98" ScaleY="0.98"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Botón principal (Agregar) -->
        <Style x:Key="PrimaryButton" TargetType="Button" BasedOn="{StaticResource PillButtonBase}">
            <Setter Property="Background" Value="{StaticResource AccentTeal}"/>
        </Style>
        <!-- Botón secundario (Actualizar) -->
        <Style x:Key="AccentButton" TargetType="Button" BasedOn="{StaticResource PillButtonBase}">
            <Setter Property="Background" Value="{StaticResource AccentBlue}"/>
        </Style>
        <!-- Botón de peligro (Eliminar) -->
        <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource PillButtonBase}">
            <Setter Property="Background" Value="{StaticResource DangerColor}"/>
        </Style>

        <!-- Estilo para TextBox oscuro, usado en el input de categoría -->
        <Style x:Key="DarkTextBox" TargetType="TextBox">
            <Setter Property="Height" Value="{StaticResource CtlHeight}"/>
            <Setter Property="Background" Value="{StaticResource CardBg}"/>
            <Setter Property="Foreground" Value="{StaticResource HeaderText}"/>
            <Setter Property="BorderBrush" Value="{StaticResource RowDivider}"/>
            <Setter Property="Padding" Value="12,0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="Bd" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ScrollViewer x:Name="PART_ContentHost" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="{StaticResource AccentTeal}"/>
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="{StaticResource AccentTeal}"/>
                                <Setter TargetName="Bd" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#22000000" BlurRadius="6" ShadowDepth="2"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Estilos para DataGrid y encabezados -->
        <Style x:Key="GridHeaderStyle" TargetType="DataGridColumnHeader">
            <Setter Property="Foreground" Value="{StaticResource AccentTeal}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="{StaticResource RowDivider}"/>
        </Style>

        <Style x:Key="GridCellStyle" TargetType="DataGridCell">
            <Setter Property="Foreground" Value="{StaticResource HeaderText}"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="{StaticResource RowDivider}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#081617"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#0A2A2F"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="GridRowStyle" TargetType="DataGridRow">
            <Setter Property="MinHeight" Value="36"/>
        </Style>

        <!-- Estilo visual para DataGrid -->
        <Style x:Key="NiceDataGrid" TargetType="DataGrid">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="RowBackground" Value="#0F000000"/>
            <Setter Property="AlternatingRowBackground" Value="#14000000"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#1FFFFFFF"/>
            <Setter Property="VerticalGridLinesBrush" Value="#0FFFFFFF"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>

        <Style x:Key="NiceGridHeaderStyle" TargetType="DataGridColumnHeader">
            <Setter Property="Foreground" Value="{StaticResource AccentTeal}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Encabezado con icono y título -->
        <DockPanel Grid.Row="0" Margin="0,0,0,12">
            <StackPanel Orientation="Horizontal">
                <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8D1;" FontSize="20" Foreground="{StaticResource AccentTeal}" Margin="0,0,8,0"/>
                <StackPanel>
                    <TextBlock Text="Categorías" FontSize="20" FontWeight="Bold" Foreground="{StaticResource HeaderText}"/>
                    <TextBlock Text="Administra las categorías" Foreground="{StaticResource MutedText}" FontSize="12"/>
                </StackPanel>
            </StackPanel>
        </DockPanel>

        <!-- Tarjeta de entrada para agregar/actualizar categorías -->
        <Border Grid.Row="1" Background="{StaticResource CardBgLight}" CornerRadius="10" Padding="14" Margin="0,0,0,12" materialDesign:ShadowAssist.ShadowDepth="Depth1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Input para nombre de la categoría -->
                <StackPanel Grid.Column="0" Margin="0,0,12,0">
                    <TextBlock Text="Nombre de la categoría" Foreground="{StaticResource AccentTeal}" FontSize="12" Margin="2,0,0,6"/>
                    <TextBox x:Name="txtNombreCategoria"
                             Style="{StaticResource DarkTextBox}"
                             FontSize="{StaticResource CtlFontSize}"
                             VerticalContentAlignment="Center"
                             ToolTip="Escribe el nombre y pulsa Agregar o Actualizar"/>
                </StackPanel>

                <!-- Botón Agregar: solo habilitado si hay texto -->
                <Button Grid.Column="1" x:Name="btnAgregar" Padding="{StaticResource CtlPadding}" MinHeight="{StaticResource CtlHeight}" Click="BtnAgregar_Click" Background="{StaticResource AccentTeal}" Foreground="{StaticResource HeaderText}" Margin="0,22,8,0">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
                            <Setter Property="IsEnabled" Value="True"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Text.Length, ElementName=txtNombreCategoria}" Value="0">
                                    <Setter Property="IsEnabled" Value="False"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE710;" Margin="0,0,6,0"/>
                        <TextBlock Text="Agregar"/>
                    </StackPanel>
                </Button>

                <!-- Botón Actualizar: solo habilitado si hay selección y texto -->
                <Button Grid.Column="2" x:Name="btnActualizar" Padding="{StaticResource CtlPadding}" MinHeight="{StaticResource CtlHeight}" Click="BtnActualizar_Click" Background="{StaticResource AccentBlue}" Foreground="{StaticResource HeaderText}" Margin="0,22,0,0">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource AccentButton}">
                            <Setter Property="IsEnabled" Value="True"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding SelectedItem, ElementName=dgCategorias}" Value="{x:Null}">
                                    <Setter Property="IsEnabled" Value="False"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Text.Length, ElementName=txtNombreCategoria}" Value="0">
                                    <Setter Property="IsEnabled" Value="False"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE777;" Margin="0,0,6,0"/>
                        <TextBlock Text="Actualizar"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>

        <!-- Lista de categorías en DataGrid -->
        <Border Grid.Row="2" Background="{StaticResource CardBg}" CornerRadius="10" Padding="12" materialDesign:ShadowAssist.ShadowDepth="Depth2" Margin="0,0,0,12">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Text="Lista de categorías" Foreground="{StaticResource HeaderText}" FontSize="14" FontWeight="SemiBold" Margin="6,0,0,8"/>

                <DataGrid x:Name="dgCategorias"
                          Grid.Row="1"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          IsReadOnly="True"
                          SelectionMode="Single"
                          SelectionChanged="dgCategorias_SelectionChanged"
                          Style="{StaticResource NiceDataGrid}"
                          ColumnHeaderStyle="{StaticResource NiceGridHeaderStyle}"
                          HeadersVisibility="Column"
                          AlternationCount="2"
                          CanUserResizeRows="False"
                          Background="Transparent"
                          BorderThickness="0"
                          Foreground="{StaticResource HeaderText}"
                          materialDesign:DataGridAssist.CellPadding="10,8,10,8"
                          materialDesign:DataGridAssist.ColumnHeaderPadding="10,8,10,8"
                          ScrollViewer.VerticalScrollBarVisibility="Auto"
                          >
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="90" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Nombre" Binding="{Binding Nombre}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>

        <!-- Footer: consejo y botón Eliminar -->
        <DockPanel Grid.Row="3">
            <TextBlock Text="Consejo: selecciona una fila para editarla, o escribe y pulsa Agregar." Foreground="{StaticResource MutedText}" FontSize="11" VerticalAlignment="Center"/>
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                <!-- Botón Eliminar: solo habilitado si hay selección -->
                <Button x:Name="btnEliminar" Padding="12,8" Click="BtnEliminar_Click" Background="{StaticResource DangerColor}" Foreground="{StaticResource HeaderText}" Width="129">
                    <Button.Style>
                        <Style TargetType="{x:Type Button}" BasedOn="{StaticResource DangerButton}">
                            <Setter Property="IsEnabled" Value="True"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding SelectedItem, ElementName=dgCategorias}" Value="{x:Null}">
                                    <Setter Property="IsEnabled" Value="False"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE74D;" Margin="0,0,6,0"/>
                        <TextBlock Text="Eliminar"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </DockPanel>
    </Grid>
</Window>