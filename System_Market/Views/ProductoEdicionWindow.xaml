<Window x:Class="System_Market.Views.ProductoEdicionWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/wpf/xaml/themes"
        xmlns:sys="clr-namespace:System;assembly=System.Runtime"
        Title="Producto"
        Height="546" Width="612"
        MinHeight="550" MinWidth="600"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource MainBg}"
        FontFamily="Segoe UI"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True">

    <Window.Resources>
        <!-- Fondo principal en degradado -->
        <LinearGradientBrush x:Key="MainBg" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#0F225E" Offset="0"/>
            <GradientStop Color="#0E0F73" Offset="0.3"/>
            <GradientStop Color="#1A5AAE" Offset="1"/>
        </LinearGradientBrush>

        <!-- Altura y tamaño de fuente estándar para controles -->
        <sys:Double x:Key="CtlHeight">44</sys:Double>
        <sys:Double x:Key="CtlFontSize">14</sys:Double>
        <Thickness x:Key="CtlPadding">16,8</Thickness>

        <!-- Gradientes para botones principales y de cancelar -->
        <LinearGradientBrush x:Key="BtnPrimaryBg" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#2766FF" Offset="0"/>
            <GradientStop Color="#0F3CF0" Offset="1"/>
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="BtnCancelBg" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#1EC8FF" Offset="0"/>
            <GradientStop Color="#0B8DE6" Offset="1"/>
        </LinearGradientBrush>

        <!-- Estilo para bordes tipo "píldora" en campos -->
        <Style x:Key="PillBorder" TargetType="Border">
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Background" Value="#1AFFFFFF"/>
            <Setter Property="Padding" Value="6"/>
        </Style>

        <!-- TextBox plano, sin borde, para inputs -->
        <Style x:Key="FlatTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="{StaticResource CtlFontSize}"/>
            <Setter Property="Padding" Value="6,0"/>
        </Style>

        <!-- ComboBox personalizado para mejor apariencia -->
        <Style x:Key="NiceComboBox" TargetType="ComboBox">
            <!-- ...igual que antes... -->
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="6,0"/>
            <Setter Property="FontSize" Value="{StaticResource CtlFontSize}"/>
            <Setter Property="MinHeight" Value="{StaticResource CtlHeight}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <Border x:Name="Bd"
                                    Background="Transparent"
                                    CornerRadius="6"
                                    SnapsToDevicePixels="True">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition Width="36"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Margin="6,0,6,0"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Left"
                                               Text="{Binding SelectedItem.Nombre, RelativeSource={RelativeSource TemplatedParent}, TargetNullValue=''}"
                                               Foreground="White"
                                               TextTrimming="CharacterEllipsis"/>

                                    <ToggleButton Grid.Column="1"
                                                  x:Name="ToggleButton"
                                                  Focusable="False"
                                                  IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                                  Background="Transparent"
                                                  BorderThickness="0"
                                                  Style="{x:Null}"
                                                  HorizontalContentAlignment="Center"
                                                  VerticalContentAlignment="Center">
                                        <TextBlock FontFamily="Segoe MDL2 Assets" Text="" FontSize="14" Foreground="#CCFFFFFF"/>
                                    </ToggleButton>
                                </Grid>
                            </Border>

                            <Popup x:Name="PART_Popup"
                                   Placement="Bottom"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   PopupAnimation="Fade"
                                   StaysOpen="False">
                                <Border CornerRadius="6" Background="#0F1F3A" BorderBrush="#22000000" BorderThickness="1"
                                        SnapsToDevicePixels="True" Padding="4" MinWidth="{Binding ActualWidth, RelativeSource={RelativeSource TemplatedParent}}">
                                    <Border.Effect>
                                        <DropShadowEffect BlurRadius="10" ShadowDepth="4" Color="#44000000"/>
                                    </Border.Effect>

                                    <ScrollViewer CanContentScroll="True" VerticalScrollBarVisibility="Auto" MaxHeight="220">
                                        <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="HasItems" Value="False">
                                <Setter TargetName="PART_Popup" Property="Visibility" Value="Collapsed"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#88FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <!-- ItemContainerStyle idem -->
        </Style>

        <!-- Estilo para el título principal -->
        <Style x:Key="HeaderTitle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="22"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
        </Style>

        <!-- Estilo para etiquetas de campos -->
        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#CFE9FF"/>
            <Setter Property="TextWrapping" Value="NoWrap"/>
            <Setter Property="Margin" Value="2,0,0,6"/>
        </Style>

        <!-- Botón principal con efecto visual -->
        <Style x:Key="PrimaryActionButton" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="{StaticResource BtnPrimaryBg}"/>
            <Setter Property="Padding" Value="{StaticResource CtlPadding}"/>
            <Setter Property="MinHeight" Value="48"/>
            <Setter Property="MinWidth" Value="140"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Effect" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="10" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="RenderTransform">
                        <Setter.Value>
                            <ScaleTransform ScaleX="1.04" ScaleY="1.04"/>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect BlurRadius="14" ShadowDepth="6" Color="#40000000"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="RenderTransform">
                        <Setter.Value>
                            <ScaleTransform ScaleX="0.98" ScaleY="0.98"/>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect BlurRadius="8" ShadowDepth="2" Color="#22000000"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Botón de cancelar basado en el principal -->
        <Style x:Key="CancelActionButton" TargetType="Button" BasedOn="{StaticResource PrimaryActionButton}">
            <Setter Property="Background" Value="{StaticResource BtnCancelBg}"/>
            <Setter Property="MinWidth" Value="160"/>
        </Style>
    </Window.Resources>

    <Grid Margin="12" Background="Transparent">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- Título principal de la ventana -->
        <StackPanel Grid.Row="0" Grid.ColumnSpan="2" Margin="10,8,10,16">
            <TextBlock Style="{StaticResource HeaderTitle}" Text="DATOS DEL PRODUCTO" />
        </StackPanel>

        <!-- Formulario principal de edición de producto -->
        <Border Grid.Row="1" Grid.ColumnSpan="2" CornerRadius="12" Background="#0D000000" Padding="18" Margin="10,0,10,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="12"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="12"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="12"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Campo: Código de barras -->
                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,12,0">
                    <TextBlock Style="{StaticResource FieldLabel}" Text="CÓDIGO DE BARRAS"/>
                    <Border Style="{StaticResource PillBorder}">
                        <TextBox x:Name="txtCodigoBarras" Style="{StaticResource FlatTextBox}"
                                 ToolTip="Escanea o escribe el código"/>
                    </Border>
                    <TextBlock x:Name="txtEstadoCodigo" FontSize="11" Foreground="#88FFFFFF" Margin="4,6,0,0" Text="Escanear o escribe codigo"/>
                </StackPanel>

                <!-- Campo: Nombre del producto -->
                <StackPanel Grid.Row="0" Grid.Column="1" Margin="12,0,0,0">
                    <TextBlock Style="{StaticResource FieldLabel}" Text="NOMBRE DEL PRODUCTO"/>
                    <Border Style="{StaticResource PillBorder}">
                        <TextBox x:Name="txtNombre" Style="{StaticResource FlatTextBox}"
                                 ToolTip="Nombre comercial del producto"/>
                    </Border>
                </StackPanel>

                <!-- Campo: Categoría -->
                <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,12,0">
                    <TextBlock Style="{StaticResource FieldLabel}" Text="CATEGORÍA"/>
                    <Border Style="{StaticResource PillBorder}">
                        <ComboBox x:Name="cbCategoria" Style="{StaticResource NiceComboBox}"
                                  DisplayMemberPath="Nombre" SelectedValuePath="Id"
                                  ToolTip="Selecciona una categoría"/>
                    </Border>
                </StackPanel>

                <!-- Campo: Proveedor -->
                <StackPanel Grid.Row="2" Grid.Column="1" Margin="12,0,0,0">
                    <TextBlock Style="{StaticResource FieldLabel}" Text="PROVEEDOR"/>
                    <Border Style="{StaticResource PillBorder}">
                        <ComboBox x:Name="cbProveedor" Style="{StaticResource NiceComboBox}"
                                  DisplayMemberPath="Nombre" SelectedValuePath="Id"
                                  ToolTip="Selecciona un proveedor"/>
                    </Border>
                </StackPanel>

                <!-- Campo: Precio de compra -->
                <StackPanel Grid.Row="4" Grid.Column="0" Margin="0,0,12,0">
                    <TextBlock Style="{StaticResource FieldLabel}" Text="PRECIO DE COMPRA"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="44"/>
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Border Grid.Column="0" CornerRadius="8" Background="#0F000000" HorizontalAlignment="Left" Margin="0,0,6,0">
                            <TextBlock Text="S/" Foreground="White" VerticalAlignment="Center" HorizontalAlignment="Center" Padding="10,6"/>
                        </Border>
                        <Border Grid.Column="1" Style="{StaticResource PillBorder}">
                            <TextBox x:Name="txtPrecioCompra" Style="{StaticResource FlatTextBox}"
                                     TextAlignment="Right"
                                     ToolTip="Solo números y punto/coma (ej. 12.50)"/>
                        </Border>
                    </Grid>
                </StackPanel>

                <!-- Campo: Precio de venta -->
                <StackPanel Grid.Row="4" Grid.Column="1" Margin="12,0,0,0">
                    <TextBlock Style="{StaticResource FieldLabel}" Text="PRECIO DE VENTA (S)"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="44"/>
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Border Grid.Column="0" CornerRadius="8" Background="#0F000000" HorizontalAlignment="Left" Margin="0,0,6,0">
                            <TextBlock Text="S/" Foreground="White" VerticalAlignment="Center" HorizontalAlignment="Center" Padding="10,6"/>
                        </Border>
                        <Border Grid.Column="1" Style="{StaticResource PillBorder}">
                            <TextBox x:Name="txtPrecioVenta" Style="{StaticResource FlatTextBox}"
                                     TextAlignment="Right"
                                     ToolTip="Solo números y punto/coma (ej. 15.90)"/>
                        </Border>
                    </Grid>
                </StackPanel>

                <!-- Campo: Stock -->
                <StackPanel Grid.Row="6" Grid.ColumnSpan="2" Margin="0,10,0,0">
                    <TextBlock Style="{StaticResource FieldLabel}" Text="CANTIDAD EN-STOCK"/>
                    <Border Style="{StaticResource PillBorder}" Width="220">
                        <TextBox x:Name="txtStock" Style="{StaticResource FlatTextBox}"
                                 TextAlignment="Right"
                                 ToolTip="Solo dígitos (ej. 10)"/>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Botones de acción: Cancelar y Guardar -->
        <StackPanel Grid.Row="2" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="10,0,10,12">
            <Button x:Name="BtnCancelar" Content="←  Cancelar"
                    Style="{StaticResource CancelActionButton}"
                    Margin="0,0,12,0"
                    IsCancel="True"
                    Click="BtnCancelar_Click"/>
            <Button x:Name="BtnGuardar" Padding="{StaticResource CtlPadding}" MinHeight="48" MinWidth="160"
                    Style="{StaticResource PrimaryActionButton}"
                    IsDefault="True"
                    Click="BtnGuardar_Click">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE74E;" Margin="0,0,8,0" VerticalAlignment="Center"/>
                    <TextBlock Text="Guardar" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
        </StackPanel>
    </Grid>
</Window>